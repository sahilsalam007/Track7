<%- include("../../views/partials/user/header") %>
<style>
 .card-green {
   background-color: #ADD8E6;
 }
 .main {
   padding: 30px 0;
 }


 .dashboard-menu {
   background-color: #cce3e6;
   border-radius: 10px;
   padding: 15px;
   box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
 }


 .dashboard-menu .nav-link {
 font-weight: bold;
 color: #30683c;
 box-shadow: 0 4px 10px rgba(123, 131, 112, 0.3), 0 4px 20px rgba(0, 191, 255, 0.2);
 transition: box-shadow 0.3s ease;
}


.dashboard-menu .nav-link:hover {
 color: #00bfff;
 box-shadow: 0 4px 15px rgba(173, 255, 47, 0.5), 0 6px 25px rgba(0, 191, 255, 0.4);
}


 .card {
   border-radius: 10px;
   box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
   margin-bottom: 20px;
 }


 .card-header {
   background-color: #487379;
   color: white;
   border-radius: 10px 10px 0 0;
 }


 .btn-success {
   background-color: #577194;
   border-color: #6bb87d;
 }


 .btn-success:hover {
   background-color: #506955;
 }


 .form-group {
   margin-bottom: 15px;
 }


 .required {
   color: red;
 }


  @media (max-width: 768px) {
   .dashboard-menu {
     padding: 10px;
   }


   .card {
     margin-bottom: 15px;
   }
 }
 .page-header.breadcrumb-wrap {
 background-color: #eee2e9;
 padding: 15px 0;
}


.breadcrumb {
 display: flex;
 align-items: center;
 font-family: 'Arial', sans-serif;
 font-size: 16px;
 color: #121311;
}


.breadcrumb a {
 color: #007bff;
 text-decoration: none;
 position: relative;
 margin: 0 5px;
}


.breadcrumb a:hover {
 color: #0056b3;
}


.breadcrumb span {
 margin: 0 5px;
 color: #999;
}


.breadcrumb a::after {
 content: '';
 position: absolute;
 width: 100%;
 height: 2px;
 background: #6e6e3a;
 left: 0;
 bottom: -2px;
 transform: scaleX(0);
 transition: transform 0.3s ease;
}


.breadcrumb a:hover::after {
 transform: scaleX(1);
}
</style>


<main class="main">
 <div class="page-header breadcrumb-wrap mb-3">
   <div class="container">
     <div class="breadcrumb">
       <a href="#" rel="nofollow">Home</a>
       <span></span> Profile <span></span> Account
     </div>
   </div>
 </div>
  <section class="pt-10 pb-10">
   <div class="container">
     <div class="row">
       <div class="col-lg-10 m-auto">
         <div class="row">
           <div class="col-md-4">
             <div class="dashboard-menu">
               <ul class="nav flex-column" role="tablist">
                 <li class="nav-item">
                   <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" href="#dashboard" role="tab" aria-controls="dashboard" aria-selected="false">
                     <i class="fi-rs-settings-sliders mr-10"></i>Dashboard
                   </a>
                 </li>
                 <li class="nav-item">
                   <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address" role="tab" aria-controls="address" aria-selected="true">
                     <i class="fi-rs-marker mr-10"></i>My Address
                   </a>
                 </li>
                 <a class="nav-link" id="orders-tab" href="/orders">
                  <i class="fi-rs-shopping-bag mr-10"></i>Orders
                </a>
                
                 <li class="nav-item">
                   <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#wallet-history" role="tab" aria-controls="track-orders" aria-selected="false">
                     <i class="fi-rs-shopping-cart-check mr-10"></i>Wallet
                   </a>
                 </li>
                 <li class="nav-item">
                   <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#referal" role="tab" aria-controls="track-orders" aria-selected="false">
                     <i class="fi-rs-shopping-cart-check mr-10"></i>Referals
                   </a>
                 </li>
                 <li class="nav-item">
                   <a class="nav-link" href="/logout">
                     <i class="fi-rs-sign-out mr-10"></i>Logout
                   </a>
                 </li>
               </ul>
             </div>
           </div>
           <div class="col-md-8">
             <div class="tab-content dashboard-content">


               <div class="tab-pane fade show active" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                 <div class="card card-green">
                   <div class="card-header">
                     <h5 class="mb-0 text-center">User Profile</h5>
                   </div>
                   <div class="card-body text-center">
                     <h5 class="card-title"><%=user.name%></h5>
                     <p class="card-text">
                       <strong>Phone:</strong><%=user.phone%>
                     </p>
                     <p class="card-text">
                       <strong>Email:</strong><%=user.email%>
                     </p>
                     <a href="/change-email" class="btn btn-sm btn-success ml-2">Change Email</a>
                     <a href="/change-password" class="btn btn-sm btn-success">Change Password</a>
                   </div>
                 </div>
               </div>


               <div
                 class="tab-pane fade"
                 id="address"
                 role="tabpanel"
                 aria-labelledby="address-tab"
               >
                 <div class="row">
                  <%if(userAddress) {%>
                     <%userAddress.address.forEach((address)=>{%>
                   <div class="col-lg-6">
                     <div class="card mb-3 mb-lg-0">
                       <div class="card-header">
                         <h5 class="mb-0"><%=address.addressType%></h5>
                       </div>


                       <div class="card-body">
                         <address>
                           <%=address.name%><br/>
                           <%=address.city%><br/>
                           <%=address.landMark%><br/>
                           <%=address.state%><br/>
                         </address>
                         <p><%=address.pincode%></p>
                         <p><%=address.phone%></p>
                         <p><%=address.altPhone%></p>
                      
                         <div class="d-flex justify-content-between">
                           <a href="/editAddress?id=<%=address._id%>" class="btn-small">Edit</a>
                           <a href="/deleteAddress?id=<%=address._id%>" class="btn-small" onclick="return confirm('Are you sure you want to delete this address?')">Delete</a>
                         </div>
                        
                       </div>
                     </div>
                   </div>
                   <%})%><%}else{%>
                
                   <div class="col-lg-6">
                     <div class="card mb-3 mb-lg-0">
                       <div class="card-header">
                         <h5 class="mb-0"></h5>
                       </div>
                       <div class="card-body">
                         <address>No address</address>
                       </div>
                     </div>
                   </div>
                   <%}%>
              
                   <div>
                     <a href="/addAddress">
                       <button class="btn btn-primary w-70">
                         Add address
                       </button>
                     </a>
                   </div>
                 </div>
               </div>


               <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                 <div class="card">
                   <div class="card-header">
                     <h5 class="mb-0">Your Orders</h5>
                   </div>
                   <div class="card-body">
                     <div class="table-responsive">
                       <table class="table">
                         <thead>
                           <tr>
                             <th>Order</th>
                             <th>Status</th>
                             <th>Total</th>
                             <th>Actions</th>
                           </tr>
                         </thead>
                         <tbody>
                           <tr>
                             <td></td>
                             <td></td>
                             <td></td>
                             <td>
                               <a href="" class="btn-small d-block">View</a>
                             </td>
                           </tr>
                         </tbody>
                       </table>
                     </div>
                   </div>
                 </div>
               </div>


               

               <div class="tab-pane fade" id="wallet-history" role="tabpanel" aria-labelledby="orders-tab">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Wallet Balance: â‚¹<%= wallet && wallet.balance ? wallet.balance.toFixed(2) : '0.00' %></h5>
                    </div>
                    <div class="card-body">
                        <% if (wallet && wallet.transactions && wallet.transactions.length > 0) { %>
                            <div class="table-responsive">
                                <table class="table" id="transactions-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Type</th>
                                            <th>Amount</th>
                                            <th>Description</th>
                                        </tr>
                                    </thead>
                                    <tbody id="transactions-body">
                                        <% wallet.transactions.forEach(transaction => { %>
                                            <tr>
                                                <td><%= new Date(transaction.createdAt).toLocaleDateString() %></td>
                                                <td>
                                                    <% if (transaction.type === 'credit') { %>
                                                        <span style="color: #98780d; font-weight: 500;">Credit</span>
                                                    <% } else { %>
                                                        <span class="text-danger" style="font-weight: 500;">Debit</span>
                                                    <% } %>
                                                </td>
                                                <td>â‚¹<%= transaction.amount.toFixed(2) %></td>
                                                <td><%= transaction.description %></td>
                                            </tr>
                                        <% }); %>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Pagination Controls -->
                            <nav aria-label="Page navigation">
                                <ul class="pagination justify-content-center" id="pagination-controls">
                                    <!-- Pagination buttons will be dynamically added here -->
                                </ul>
                            </nav>
                        <% } else { %>
                            <p class="text-center text-muted">No transactions available.</p>
                        <% } %>
                    </div>
                </div>
            </div>
            


               <div class="tab-pane fade" id="referal" role="tabpanel" aria-labelledby="track-orders-tab">
                 <div class="card">
                   <div class="card-header">
                     <h5 class="mb-0">Referal</h5>
                   </div>
                   <div class="card-body">
                     <h6 class="mb-3">Refer your friends and earn money!</h6>
                     <p>Share this link: <strong>></strong></p>
                     <p>Earned: â‚¹</p>
                   </div>
                 </div>
               </div>
       </div>
     </div>
   </div>
 </section>
</main>
<script>
document.addEventListener("DOMContentLoaded", function () {
    let ordersTab = document.getElementById("orders-tab");
    if (ordersTab) {
        ordersTab.addEventListener("click", function () {
            window.location.href = "/orders"; 
        });
    }
});



</script>
<script>
  // Store the transactions in a variable (this will be from the EJS template)
  const transactions = <%- JSON.stringify(wallet.transactions) %>; // This is correct. No need for `${}`

  const transactionsPerPage = 10; // Number of transactions per page
  let currentPage = 1; // Start on the first page

  // Function to render transactions for the current page
  function renderTransactions(page) {
      const start = (page - 1) * transactionsPerPage;
      const end = start + transactionsPerPage;
      const transactionsToShow = transactions.slice(start, end);

      const tbody = document.getElementById('transactions-body');
      tbody.innerHTML = ''; // Clear the table body

      transactionsToShow.forEach(transaction => {
          const row = document.createElement('tr');
          row.innerHTML = `
              <td>${new Date(transaction.createdAt).toLocaleDateString()}</td>
              <td>${transaction.type === 'credit' ? '<span style="color: #98780d; font-weight: 500;">Credit</span>' : '<span class="text-danger" style="font-weight: 500;">Debit</span>'}</td>
              <td>â‚¹${transaction.amount.toFixed(2)}</td>
              <td>${transaction.description}</td>
          `;
          tbody.appendChild(row);
      });
  }

  // Function to render pagination controls
  function renderPagination() {
      const totalPages = Math.ceil(transactions.length / transactionsPerPage);
      const paginationControls = document.getElementById('pagination-controls');
      paginationControls.innerHTML = ''; // Clear existing pagination controls

      // Previous page button
      const prevButton = document.createElement('li');
      prevButton.classList.add('page-item');
      prevButton.innerHTML = `
          <a class="page-link" href="#" aria-label="Previous" onclick="changePage(currentPage - 1)">
              <span aria-hidden="true">&laquo;</span>
          </a>
      `;
      if (currentPage === 1) prevButton.classList.add('disabled');
      paginationControls.appendChild(prevButton);

      // Page number buttons
      for (let i = 1; i <= totalPages; i++) {
          const pageButton = document.createElement('li');
          pageButton.classList.add('page-item');
          pageButton.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i})">${i}</a>`;
          if (i === currentPage) pageButton.classList.add('active');
          paginationControls.appendChild(pageButton);
      }

      // Next page button
      const nextButton = document.createElement('li');
      nextButton.classList.add('page-item');
      nextButton.innerHTML = ` 
          <a class="page-link" href="#" aria-label="Next" onclick="changePage(currentPage + 1)">
              <span aria-hidden="true">&raquo;</span>
          </a>
      `;
      if (currentPage === totalPages) nextButton.classList.add('disabled');
      paginationControls.appendChild(nextButton);
  }

  // Function to change the current page and re-render transactions and pagination
  function changePage(page) {
      const totalPages = Math.ceil(transactions.length / transactionsPerPage);
      if (page < 1 || page > totalPages) return; // Don't change page if out of range
      currentPage = page;
      renderTransactions(currentPage);
      renderPagination();
  }

  // Initialize the page with the first page of transactions
  renderTransactions(currentPage);
  renderPagination();
</script>

<%- include("../../views/partials/user/footer") %>





